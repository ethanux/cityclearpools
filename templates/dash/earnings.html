{% extends 'dash/base.html' %}

  {% block links %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
  {% endblock %}
  {% block styles %}
    body {
      background-color: #121212;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
    }
    .card {
      background-color: #1e1e1e;
      border: none;
      border-radius: 1rem;
    }
    .table thead {
      background-color: #343a40;
    }
    .filter-section {
      background-color: #1e1e1e;
      border-radius: 1rem;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }
    .form-control, .form-select {
      background-color: #2c2c2c;
      border: 1px solid #444;
      color: #fff;
    }
    .form-control:focus, .form-select:focus {
      box-shadow: none;
      border-color: #555;
    }
    {% endblock %}

 {% block nav %}
    <div class="nav-items">
        <a href="" class="nav-link " data-bs-toggle="tooltip" title="Dashboard">
            <i class="bi bi-house"></i>
        </a>
        <a href="" class="nav-link active" data-bs-toggle="tooltip" title="Earnings & withdrawals ">
            <i class="bi bi-receipt"></i>
        </a>
         <a href="" class="nav-link" data-bs-toggle="tooltip" title="Deliveries ">
            <i class="bi bi-truck"></i>
        </a>

        
    </div>
    {% endblock %}

{% block content %}
 <div class="message-container" id="message-container"></div>
<div class="container py-4">
  <h2 class="mb-4">DashBoard</h2>
  <div class="row g-3">
    <!-- <div class="col-6 col-md-4">
      <div class="card text-center p-3">
        <h6>Total Ratings</h6>
        <h4>0</h4>
      </div>
    </div>
    <div class="col-6 col-md-4">
      <div class="card text-center p-3">
        <h6>Total Clients rated</h6>
        <h4>0</h4>
      </div>
    </div>
    <div class="col-6 col-md-4">
      <div class="card text-center p-3">
        <h6>total projects</h6>
        <h4>0</h4>
      </div>
    </div> -->
    <!-- <div class="col-6 col-md-3">
      <div class="card text-center p-3">
        <h6>Last Withdrawal</h6>
        <h4>$300</h4>
      </div>
    </div> -->
  </div>

 <!-- Upload Project Form -->
<div class="card my-4 p-4">
  <h5>Add Projects</h5>
  <form action="{{ url_for('upload_project') }}" method="POST" enctype="multipart/form-data">
    <div class="row g-3">
      <!-- Image Upload -->
      <div class="col-12 col-md-6">
        <label for="image" class="form-label">Image</label>
        <input type="file" class="form-control" id="image" name="image" required>
      </div>

      <!-- Work Type -->
      <div class="col-12 col-md-6">
        <label for="type" class="form-label">Work Type</label>
        <select class="form-select" id="type" name="type">
          <option value="Repair">Repair</option>
          <option value="Revamp">Revamp</option>
          <option value="Heating">Heating</option>
          <option value="Construction">Construction</option>
          <option value="Repair/Heating">Repair/Heating</option>
          <option value="Construction/Heating">Construction/Heating</option>
          <option value="Construction/Repair">Construction/Repair</option>
        </select>
      </div>

      <!-- Comment -->
      <div class="col-12">
        <label for="comment" class="form-label">Comment</label>
        <input type="text" class="form-control" id="comment" name="comment" placeholder="Enter image comment here" required>
      </div>

      <!-- Submit -->
      <div class="col-12">
        <button type="submit" class="btn btn-primary w-100">Upload Project</button>
      </div>
    </div>
  </form>
</div>


  <!-- Filters -->
<!--   <div class="filter-section">
    <form class="row g-3 align-items-end">
      <div class="col-6 col-md-4">
        <label for="fromDate" class="form-label">From</label>
        <input type="date" class="form-control" id="fromDate">
      </div>
      <div class="col-6 col-md-4">
        <label for="toDate" class="form-label">To</label>
        <input type="date" class="form-control" id="toDate">
      </div>
      <div class="col-12 col-md-4">
        <button type="submit" class="btn btn-outline-light w-100">Filter</button>
      </div>
    </form>
  </div> -->

  <!-- Withdrawal Transactions Table -->
  <div class="table-responsive">
    <table class="table table-dark table-hover">
      <thead>
        <tr>
          <th>image</th>
          <th>Type</th>
          <th>Comment</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for project in projects %}
        <tr>
          <td><img src="{{ url_for('static', filename='uploads/' ~ project.image) }}" width="50" height="60" /></td>
          <td>{{project.ptype}}</td>
          <td>{{project.comment}}</td>
          <td><a href="{{ url_for('delete_project',project_id=project.id)}} " onclick="return confirm('Delete this project?')"  class="btn btn-danger">Delete</a></td>
        </tr>
        {% endfor %}
        
      </tbody>
    </table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function request_it() {
    const image = document.getElementById('image').value;
    const type = document.getElementById('type').value;
    const comment = document.getElementById('comment').value;

    // Send API request (SEND order_id too!)
    fetch(`/add/project/`, {
      method: 'POST',
      headers: { 
          'Content-Type': 'application/json',
          'X-CSRFToken': getCookie('csrftoken') // if CSRF is required
      },
      body: JSON.stringify({ 
          image: image,
          type:type,
          comment:comment,      
      })
    })
    .then(response => response.json())
    .then(data => {
      if(data.status == "error"){
        displayMessagesapi(data);
        
      }else{
        displayMessagesapi(data);
        
       
      }
    })

    .catch(error => {
      
        console.error('Error submitting form:', error);
    });

    

    
}

// Function to get CSRF token 
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

</script>
{% endblock %}